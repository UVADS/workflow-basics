/*
 * Nextflow Configuration File
 * 
 * This file configures execution settings for Nextflow workflows.
 * You can override these settings via command-line parameters or profiles.
 */

// Work directory for temporary files
workDir = "${params.work ?: 'work'}"

// Cache directory
cacheDir = "${params.cache ?: '.nextflow/cache'}"

// Process defaults
process {
    // Default executor
    executor = "local"
    
    // Resource defaults
    cpus = 1
    memory = "1 GB"
    time = "1h"
    
    // Error handling
    errorStrategy = "terminate"
    maxRetries = 3
    
    // Publish directory
    publishDir = [
        path: "${params.output ?: 'results'}",
        mode: "copy",
        saveAs: { filename -> filename.equals("versions.yml") ? null : filename }
    ]
}

// Executor configurations
executor {
    name = "local"
    queueSize = 100
}

// Profiles for different execution environments
profiles {
    // Local execution (default)
    local {
        process.executor = "local"
        process.cpus = 4
        process.memory = "8 GB"
    }
    
    // SLURM cluster execution
    slurm {
        process.executor = "slurm"
        process.queue = "compute"
        process.cpus = 8
        process.memory = "16 GB"
        process.time = "2h"
    }
    
    // PBS/Torque cluster execution
    pbs {
        process.executor = "pbs"
        process.queue = "workq"
        process.cpus = 4
        process.memory = "8 GB"
    }
    
    // Docker container execution
    docker {
        docker.enabled = true
        process.container = "nextflow/rnaseq:latest"
    }
    
    // Apptainer container execution (recommended)
    apptainer {
        apptainer.enabled = true
        apptainer.autoMounts = true
        process.container = "docker://nextflow/rnaseq:latest"
    }
    
    // Singularity container execution (legacy, still supported)
    singularity {
        singularity.enabled = true
        singularity.autoMounts = true
        process.container = "docker://nextflow/rnaseq:latest"
    }
    
    // Conda environment
    conda {
        conda.enabled = true
        process.conda = "envs/myenv.yml"
    }
}

// Report configuration
report {
    enabled = true
    file = "${params.output ?: 'results'}/report.html"
}

// Timeline configuration
timeline {
    enabled = true
    file = "${params.output ?: 'results'}/timeline.html"
}

// Trace configuration
trace {
    enabled = true
    file = "${params.output ?: 'results'}/trace.txt"
    fields = "task_id,hash,native_id,process,tag,name,status,exit,module,container,cpus,time,disk,memory,attempt,submit,start,complete,duration,realtime,queue,%cpu,%mem,rss,vmem,peak_rss,peak_vmem,rchar,wchar,syscr,syscw,read_bytes,write_bytes,vol_ctxt,inv_ctxt"
}

// Docker configuration
docker {
    enabled = false
    runOptions = "-u $(id -u):$(id -g)"
}

// Apptainer configuration (recommended)
apptainer {
    enabled = false
    autoMounts = true
    cacheDir = "${home}/.apptainer/cache"
}

// Singularity configuration (legacy, still supported)
singularity {
    enabled = false
    autoMounts = true
    cacheDir = "${home}/.singularity/cache"
}

// Conda configuration
conda {
    enabled = false
    createTimeout = "10m"
}

// Environment variables
env {
    PATH = "/usr/local/bin:/usr/bin:/bin"
}

// Manifest
manifest {
    name = "Simple Pipeline"
    version = "1.0.0"
    description = "A simple Nextflow workflow example"
    author = "Your Name"
    homePage = "https://github.com/yourusername/workflow-basics"
}

